---
title: "title"
author: "author"
date: "2025-01-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Libraries

# install.packages("DT")

library(nycflights13)
library(plotly)
library(dplyr)
library(DT)

# Data import

airlines <- nycflights13::airlines
airports <- nycflights13::airports
flights <- nycflights13::flights
planes <- nycflights13::planes
weather <- nycflights13::weather

```

# Exercice dplyr

Count the number of records of planes and the sum of seats by company (display real name and not the code) and display it in a table


```{r dplyr}

# Use DT::datatable

count_records <- flights %>%
  select(tailnum,carrier) %>%
  unique(.) %>%
  merge(planes,by = "tailnum") %>%
  merge(airlines,by = "carrier") %>%
  group_by(name) %>%
  summarise(n_planes=n(),
            sum_seats=sum(seats))
  
DT::datatable(count_records)

```

# Exercice ggplot2

Plot in a stacked bar plot the repartition of manufactureur by company for the top 5 companies in term of number of flights in 2013.

```{r ggplot2, echo=FALSE}

top5_companies <- merge(flights,airlines,by = "carrier") %>%
  group_by(carrier,name) %>%
  summarise(n_flights=n()) %>%
  dplyr::arrange(desc(n_flights)) %>%
  head(5)

count_manufactureur <- planes %>%
  select(tailnum,manufacturer) %>%
  merge(flights[,c("tailnum","carrier")],by="tailnum") %>%
  unique(.) %>%
  merge(airlines,by = "carrier") %>%
  filter(carrier %in% top5_companies$carrier) %>%
  group_by(name,manufacturer) %>%
  summarise(n_planes=n())

ggplot(count_manufactureur, 
       aes(fill=manufacturer,
           y=n_planes,
           x=name)) + 
  geom_bar(position="fill", stat="identity")+
  theme_bw()

```

# Exercice plotly

Plot the relationship between departure delay (dep_delay) and arrival delay (arr_delay) for flights from JFK airport and color points by company and add a regression line for each company 

```{r plotly, echo=FALSE}

data_corr <- merge(flights,airlines,by="carrier")

plot_scatter <- ggplot(data=data_corr,
                       aes(x=dep_delay,y=arr_delay,
                           colour = name)) +
  geom_point(alpha=0.5) +
  geom_smooth(method = "lm")+
  labs(title = "Relationship between dep_delay and arr_delay / compagny",
       colour="name")+
  xlab("dep_delay (minutes)")+
  ylab("arr_delay (minutes)")+
  theme_bw() 

ggplotly(plot_scatter)


```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
